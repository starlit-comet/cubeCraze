<%-include ('partials/headSection.ejs') %>

    <div class="screen-overlay"></div>
    
    <%- include ('partials/sidebar.ejs') %>

    <main class="main-wrap">
       <%- include('partials/header.ejs') %>
       <section class="content-main">
        <div class="content-header">
            <div>
                <h2 class="content-title card-title">Dashboard </h2>
                <p>Whole data about your sale here</p>
            </div>
                
                <div class="col-md-2 col-6 border">
                    <div class="custom_select">
                        <select class="form-select" id="date_select" >
                            <option value="all">Show All </option>
                            <option value="this_month" >This Month</option>
                            <option value="last_month" >Last Month</option>
                            <option value='last_3_months' >Last Three Months</option>
                            <option value="last_6_months" >Last Six Months</option>
                            <option value="last_year">Last Year</option>


                        </select>
                </div>
            </div>
        </div> <div class="row">
            <div class="col-lg-3 col-md-6">
                <div class="card card-body mb-4">
                    <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-primary-light"><i class="text-primary material-icons md-monetization_on"></i></span>
                        <div class="text">
                            <h6 class="mb-1 card-title">Revenue</h6>
                            <span>₹ <%= salesReport.totalRevenue%></span>
                            <span class="text-sm">
                            </span>
                        </div>
                    </article>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card card-body mb-4">
                    <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-success-light"><i class="text-success material-icons md-local_shipping"></i></span>
                        <div class="text">
                            <h6 class="mb-1 card-title">Orders</h6> <span><%= totalOrders %></span>
                            <span class="text-sm">
                                Including orders in transit
                            </span>
                        </div>
                    </article>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card card-body mb-4">
                    <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-warning-light"><i class="text-warning material-icons md-qr_code"></i></span>
                        <div class="text ">
                            <h6 class="mb-1 card-title">Total Cubes Sold</h6> <span class="text-success"><%= totalProductsSold %></span>
                            <span class="text-sm">
                            </span>
                        </div>
                    </article>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card card-body mb-4">
                    <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-info-light"><i class="text-info material-icons md-shopping_basket"></i></span>
                        <div class="text">
                            <h6 class="mb-1 card-title">Current Balance</h6> <span>₹ <%= walletBalance %></span>
                            <span class="text-sm">
                            </span>
                        </div>
                    </article>
                </div>
            </div>
        </div><div class="row mt-15">
            <div class="col-xl-8 col-lg-12">
                <div class="card mb-4">
                    <article class="card-body">
                        <h5 class="card-title">Revenue Base on Area</h5>
                        <canvas id="myChart2" height="217"></canvas>
                    </article>
                   
                </div>

                   
            </div>
            <div class="col-xl-6 col-lg-8">
                <div class="card mb-4">
                    
                </div>
                <article class="card-body">
                    <h5 class="card-title">Sale statistics</h5>
                    <canvas id="myChart" height="120px"></canvas>
                </article>
            </div>
        </div>
        <div class="row ">
            <div class="col-lg-4 col-md-12">
                <div>
                    <h4>Top Categories</h4>
                    <p>Top <%= salesReport.topCategories.length %> Categories based on sales</p>
                    <% salesReport.topCategories.forEach(item=> {  %>
                    <div class="card card-body ">
                        <h6><%= item[0] %></h6>
                        <p>Total <strong class="fw-bold"><%= item[1] %> </strong> products in this category has been sold.</p>
                    </div>
                    <% }) %>
                </div>
            </div>
            <div class="col-lg-4 col-md-12">
                <div>
                    <h4>Top Brands</h4>
                    <p>Top <%= salesReport.topBrands.length %> Brands based on sales</p>
                    <% salesReport.topBrands.forEach(item=> {  %>
                        <div class="card card-body ">
                            <h6><%= item[0] %></h6>
                            <p>Total <strong class="fw-bold"><%= item[1] %></strong>  products from this Brand has been sold</p>
                        </div>
                        <% }) %>
                </div>
            </div><div class="col-lg-4 col-md-12">
                <div>
                    <h4>Top Products</h4>
                    <p>Top <%= salesReport.topProducts.length %> Products based on sales</p>
                    <% salesReport.topProducts.forEach(item=> {  %>
                        <div class="card card-body ">
                            <h6><%= item.name %></h6>
                            <p>Total <strong class="fw-bold"><%= item.quantity %></strong> of this product has sold</p>
                        </div>
                        <% }) %>

                </div>
            </div>
        </div>
       
        
   
    </section> <!-- content-main end// -->
                    <script>
                        

                    document.getElementById("dashBoard123e").classList.add("active");
                    </script>
                  
                    
                    <footer class="main-footer font-xs">
                        <div class="row pb-30 pt-15">
                            <div class="col-sm-6">
                                <%= new Date().getFullYear() %>
                                ©, CubeCraze - The Cuber's first Choice.
                            </div>
                            <div class="col-sm-6">
                                <div class="text-sm-end">
                                    All rights reserved
                                </div>
                            </div>
                        </div>
                    </footer>
                    </main>
                    <script src="/assets/js/vendors/jquery-3.6.0.min.js"></script>
                    <script src="/assets/js/vendors/bootstrap.bundle.min.js"></script>
                    <script src="/assets/js/vendors/select2.min.js"></script>
                    <script src="/assets/js/vendors/perfect-scrollbar.js"></script>
                    <script src="/assets/js/vendors/jquery.fullscreen.min.js"></script>
                    <script src="/assets/js/vendors/chart.js" ></script>

                    <script type="text/javascript">
                    (function ($) {
                        "use strict";
                    
                        /*Sale statistics Chart*/
                        if ($('#myChart').length) {
                            var ctx = document.getElementById('myChart').getContext('2d');
                            var chart = new Chart(ctx, {
                                // The type of chart we want to create
                                type: 'line',
                                
                                // The data for our dataset
                                data: {
                                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                                     datasets: [{
                                            label: 'Total Sales',
                                            tension: 0.3,
                                            fill: true,
                                            backgroundColor: 'rgba(44, 120, 220, 0.2)',
                                            borderColor: 'rgba(44, 120, 220)',
                                            data: <%= JSON.stringify(salesData) %> ,
                                        },

                                    ]
                                },
                                options: {
                                    plugins: {
                                    legend: {
                                        labels: {
                                        usePointStyle: true,
                                        },
                                    }
                                    }
                                }
                            });
                        } //End if
                    /*Sale statistics Chart*/
                    if ($('#myChart2').length) {
    var ctx = document.getElementById("myChart2");
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ["Bar Graph"], // Only one group
            datasets: [
                {
                    label: "New Customers",
                    backgroundColor: "#a5c0b5",
                    data: [<%= JSON.stringify(barGraphData[0]) %>],
                    categoryPercentage: 0.9,
                    barPercentage: 0.9
                },
                {
                    label: "No. Of Orders",
                    backgroundColor: "#5897fb",
                    data: [<%= JSON.stringify(barGraphData[1]) %>],
                    categoryPercentage: 0.9,
                    barPercentage: 0.9
                },
               
                {
                    label: "No. of Products Sold",
                    backgroundColor: "#ff9076",
                    data: [<%= JSON.stringify(barGraphData[2]) %>],
                    categoryPercentage: 0.9,
                    barPercentage: 0.9
                },
                {
                    label: "New Products Added",
                    backgroundColor: "#d495e5",
                    data: [<%= JSON.stringify(barGraphData[3]) %>],
                    categoryPercentage: 0.9,
                    barPercentage: 0.9
                }
            ]
        },
        options: {
            plugins: {
                legend: {
                    labels: {
                        usePointStyle: true,
                    },
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title:{
                        display:true,
                        text:'Quanity',
                        font:{
                            size:14,
                            weight:'bold'
                        }
                    }
                },
                x: {
                    stacked: false
                }
            }
        }
    });
}

//end if
                    })(jQuery);

                    document.addEventListener('DOMContentLoaded', function () {
    const params = new URLSearchParams(window.location.search);
    const date = params.get('date');

    const selectElement = document.getElementById('date_select');

    // ✅ Set the selected value based on URL param
    if (date) {
      selectElement.value = date;
    }

    selectElement.addEventListener('change', function () {
      const selectedValue = this.value;
      const baseUrl = `/admin/dashboard`;

      // Redirect based on selection
      if (selectedValue === 'all') {
        window.location.href = baseUrl;
      } else {
        window.location.href = `${baseUrl}?date=${selectedValue}`;
      }
    });
  });
                    </script>
                    
                    
                    <!-- Main Script -->
                    <script src="/assets/js/main.js" type="text/javascript"></script>
                    
                    <!-- Sweet Alert -->
                    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
                    
                    
                    
                    
                    </body>
                    
                    </html>